function init(){d3.selectAll("#tracker_input").attr("value",trackerAddress),d3.json("/web/version",function(a){d3.selectAll("#version").text(a)}),d3.json("/web/currency_info",function(a){d3.selectAll(".symbol").text(a.symbol)}),d3.json("/fee",function(a){d3.selectAll("#pool_fee").text(a+"%")}),updateStats(),setInterval(function(){updateStats()},8e3)}function updateTracker(a){trackerAddress=a.value,localStorage.vtcTrackerAddress=a.value,updateStats()}function timeFormat(a){return a>3600?d3.format(".2r")(a/3600)+" hours":3600==a?d3.format(".2r")(a/3600)+" hour":a>60?d3.format(".2r")(a/60)+" minutes":60==a?a/60+" minute":d3.format(".2r")(a)+" seconds"}function getNextShareStats(a,b,c){if(!isFinite(a)||!isFinite(c))return{timetoshare:0,payoutprob:0};isFinite(b)||(b=0);var d=a*(1-b/100),e=4294967296*c,f=e/a,g=84600*d/e,h=1-Math.pow(Math.E,-1*g);return{timetoshare:f,payoutprob:h}}function calcDiff(a){return(4294901760*Math.pow(2,192)+1)/(Math.pow(2,256)/a+1)}function values(a){res=[];for(var b in a)res.push(a[b]);return res}function updateStats(){var a,b;d3.json("/local_stats",function(c){d3.select("#peers_in").text(c.peers.incoming),d3.select("#peers_out").text(c.peers.outgoing),d3.select("#peers_total").text(c.peers.incoming+c.peers.outgoing);var d=d3.sum(values(c.miner_hash_rates)),e=d3.sum(values(c.miner_dead_hash_rates));d3.select("#local_rate").text(d3.format(".3s")(d)+"H/s"),d3.select("#local_stale").text(d3.format(".2p")(isFinite(c.shares.orphan)&&isFinite(c.shares.dead)&&c.shares.total>0?(c.shares.orphan+c.shares.dead)/c.shares.total:0)),d3.select("#shares_total").text(c.shares.total),d3.select("#shares_orphan").text(c.shares.orphan),d3.select("#shares_dead").text(c.shares.dead),d3.select("#efficiency").text(null!=c.efficiency?d3.format(".4p")(c.efficiency):"???"),d3.select("#uptime_days").text(d3.format(".3f")(c.uptime/60/60/24)),d3.select("#block_value").text(d3.format(".3r")(c.block_value));var f=c.attempts_to_share/d;d3.select("#time_to_share").text(timeFormat(f));var g=[];for(var h in c.miner_hash_rates)g.push(h);d3.select("#local_users").text(g.length);var i=c.miner_hash_rates[trackerAddress];d3.select("#tracker_rate").text(d3.format(".3s")(i?i:0)+"H/s");var j=c.miner_dead_hash_rates[trackerAddress];d3.select("#tracker_stale").text(d3.format(".3p")(j&&i?j/i:0)),d3.select("#tracker_effective").text(d3.format(".3s")(i&&j?i-j:i?i:0)+"H/s"),d3.select("#suggested_local").text("+"+d3.format(".8f")(calcDiff(i?i:0))),d3.json("/global_stats",function(f){d3.select("#difficulty_block").text(d3.format(".6f")(f.network_block_difficulty)),d3.select("#cg_block").text(d3.format(".3s")(65536*f.network_block_difficulty)),d3.select("#network_rate").text(d3.format(".3s")(f.network_hashrate)+"H/s");var h=getNextShareStats(i,c.shares.dead/c.shares.total,c.miner_last_difficulties[trackerAddress]);d3.select("#tracker_time_next_share").text(timeFormat(h.timetoshare));var j=c.miner_last_difficulties[trackerAddress]?c.miner_last_difficulties[trackerAddress]:0;d3.select("#required_cgdiff").text(d3.format(".6f")(j)+" ("+d3.format(".3s")(65536*j)+")"),d3.select("#pool_rate").text(d3.format(".3s")(f.pool_hash_rate)+"H/s"),d3.select("#pool_stale").text(d3.format(".2p")(f.pool_stale_prop)),d3.select("#difficulty_share").text(d3.format(".6f")(f.min_difficulty)),d3.select("#cg_share").text(d3.format(".3s")(65536*f.min_difficulty)),d3.select("#difficulty_worker").text(d3.format(".6f")("0.00048828125")),d3.select("#cg_worker").text(d3.format(".3s")(.00048828125*Math.pow(2,16))),d3.select("#p_node_pool").text(d3.format(".3p")(d/f.pool_hash_rate)),d3.select("#p_pool_ltc").text(d3.format(".3p")(f.pool_hash_rate/b)),a=c.attempts_to_block/f.pool_hash_rate,d3.select("#time_to_block").text(d3.format(".3r")(a/3600)+" hours");var k=c.miner_hash_rates[trackerAddress]/f.pool_hash_rate*c.block_value*(1-c.donation_proportion);d3.select("#tracker_payout_block_day").text(d3.format(".3r")(k?k:0)),d3.select("#tracker_payout_total_day").text(d3.format(".3r")(24/(a/3600)*(k?k:0))),d3.json("/current_payouts",function(a){d3.json("/payout_addr",function(){d3.select("#tracker_payout_block_now").text(trackerAddress in a?a[trackerAddress]:0)}),a[trackerAddress]>0||d3.select("#paid_prob").text("Chance of getting paid during the next 24 hours: "+d3.format(".2p")(h.payoutprob));var b=[];for(var f in a)b.push(f);g.sort(function(a,b){return c.miner_hash_rates[b]-c.miner_hash_rates[a]}),d3.select("#p2pool_users").text(b.length),d3.selectAll("#payout").remove();var i=d3.select("#payouts tbody").selectAll().data(g).enter().append("tr").attr("id","payout");i.append("td").append("a").attr("class","address_column").text(function(a){return a}).attr("href",function(a){return explorer_prefix+"/address/"+a}).attr("target","_blank"),i.append("td").text(function(a){return d3.format(".3s")(c.miner_hash_rates[a])+"H/s"}),i.append("td").text(function(a){return d3.format(".3p")((c.miner_dead_hash_rates[a]||0)/c.miner_hash_rates[a])}),i.append("td").text(function(c){return b.indexOf(c)>-1?a[c]:"-"});var j=d3.select("#payouts").append("tr").attr("id","payout");j.append("td").append("strong").text("Total"),j.append("td").append("i").text(d3.format(".3s")(d)+"H/s"),j.append("td").text(d3.format(".3p")(e/d)),j.append("td").append("i").text(d3.sum(b,function(b){return g.indexOf(b)>-1?a[b]:0}).toFixed(8))}),d3.json("/recent_blocks",function(b){d3.selectAll("#block").remove();var c=0;d3.select("#luck_actual").text(d3.format(".3r")(b.length)),d3.select("#luck_expected").text(d3.format(".3r")(86400/a)),d3.select("#luck_day").text(d3.format(".3f")(1/(86400/a/b.length)));var d=(Date.now()/1e3-b[0].ts)/3600;d3.select("#luck_current").text(d3.format(".3f")(d)+" hours"),d3.select("#luck_block").text(d3.format(".3f")(1/(d/(a/3600))));var e=d3.select("#blocks tbody").selectAll().data(b).enter().append("tr").attr("id","block");e.append("td").append("a").text(function(a){return a.number}).attr("href",function(a){return explorer_prefix+"/block/"+a.hash}),e.append("td").text(function(a){return new Date(1e3*a.ts).toUTCString()}),e.append("td").append("span").text(function(d){c++;var e=1/(parseFloat(100*((d.ts-(c<b.length?b[c].ts:d.ts))/3600/(a/3600))).toFixed(1)/100);return d3.format(".3r")(isFinite(e)?e:0)}).attr("id",function(a){return"b"+a.number}).attr("class",function(a){var b=parseFloat(d3.select("#b"+a.number).text());return b>=1?"label label-success":1>b&&b>=.5?"label label-warning":"label label-danger"}).attr("id","luck"),e.append("td").append("a").text(function(a){return a.share.slice(0,6)+".."}).attr("href",function(a){return"/static/share.html#"+a.share})})})}),plot_later(d3.select("#main-local"),"H/s","H",[{url:"/web/graph_data/local_hash_rate/last_"+(""!=period?period:"day"),color:"#0000FF",label:"Total"},{url:"/web/graph_data/local_dead_hash_rate/last_"+(""!=period?period:"day"),color:"#FF0000",label:"Dead"}],1e3,300)}function ChangeCurrentPeriod(a,b){period=a,updateStats(),$("#scale_menu li").removeClass("active"),$("#"+b).addClass("active")}function compose(){var a=arguments;return function(b){for(var c=a.length-1;c>=0;c--)b=a[c](b);return b}}function itemgetter(a){return function(b){return b[a]}}function as_date(a){return new Date(1e3*a)}function not_null(a){return null!=a}function get_area_mean(a){for(var b=0,c=0,d=0;d<a.length;d++)null!=a[d][1]&&(b+=a[d][1]*a[d][2],c+=a[d][2]);return{area:b,mean:0==c?null:b/c}}function plot(a,b,c,d,e,f,g){var h=document.createElement("div");a.node().parentNode.insertBefore(h,a.node().nextSibling),h.style.display="none";for(var i=0;i<d.length;++i){var j=d[i],k=d3.select(h).append("table").attr("border",1).attr("style","float:left"),l=k.insert("tr");l.append("th").text("Date"),l.append("th").text(j.label+"/("+b+")");for(var m=[],n=0;n<j.data.length;++n)3==n%7&&m.push(j.data[n]);var o=k.selectAll().data(m).enter().append("tr");o.append("td").text(function(a){return new Date(1e3*a[0]).toString()}),o.append("td").text(function(a){return d3.format(".3s")(a[1])})}var p=40,q=140,r=e,s=f,t=d3.time.scale().domain([as_date(d3.min(d,function(a){return d3.min(a.data,itemgetter(0))})),as_date(d3.max(d,function(a){return d3.max(a.data,itemgetter(0))}))]).range([0+q,r-q]);if(a.attr("width",r).attr("height",s),a.selectAll("*").remove(),g){var u=d3.layout.stack().x(itemgetter(0)).y(itemgetter(1)).values(function(a){return a.data})(d),v=d3.scale.linear().domain([0,d3.max(u,function(a){return d3.max(a.data,function(a){return a.y0+a.y})})]).range([s-p,p]),w=d3.scale.linear().domain([0,1]).range([s-p,p]);a.selectAll().data(d).enter().append("svg:path").attr("d",function(a){return d3.svg.area().x(function(a){return t(as_date(a[0]))}).y0(function(a){return v(a.y0)}).y1(function(a){return v(a.y0+a.y)}).defined(compose(not_null,itemgetter(1)))(a.data)}).style("fill",function(a){return a.color}).attr("stroke",function(a){return a.color}).attr("class","plotline");for(var x=0,y=0,i=0;i<d.length;++i){var j=d[i],z=get_area_mean(j.data);null!=z.mean&&(x+=z.mean,y+=z.area)}for(var i=0;i<d.length;++i){var j=d[i],z=get_area_mean(j.data);if(null!=z.mean){for(var A=0,B=0,n=0;n<j.data.length;n++)if(null!=j.data[n]){var C=j.data[n];A+=(C.y+1)*(C.y0+C.y+C.y0)/2,B+=C.y+1}a.append("svg:line").style("stroke",j.color).attr("x1",r-q+3).attr("y1",v(A/B)).attr("x2",r-q+10).attr("y2",w(i/d.length)),a.append("svg:text").text(j.label+" (mean: "+d3.format(".3s")(z.mean)+b+")").attr("text-anchor","start").attr("dominant-baseline","central").attr("fill",j.color).attr("x",r-q+10).attr("y",w(i/d.length)),null!=c&&a.append("svg:text").text("Area: "+d3.format(".3s")(z.area)+c+" ("+d3.format(".2p")(z.area/y)+" total)").attr("text-anchor","start").attr("dominant-baseline","central").attr("fill",j.color).attr("x",r-q+10).attr("y",w(i/d.length)+12)}}a.append("svg:line").style("stroke","black").attr("x1",r-q+3).attr("y1",v(x)).attr("x2",r-q+10).attr("y2",w(1)),a.append("svg:text").text("Total (mean: "+d3.format(".3s")(x)+b+")").attr("text-anchor","start").attr("dominant-baseline","central").attr("fill","black").attr("x",r-q+10).attr("y",w(1)),null!=c&&a.append("svg:text").text("Area: "+d3.format(".3s")(y)+c).attr("text-anchor","start").attr("dominant-baseline","central").attr("fill","black").attr("x",r-q+10).attr("y",w(1)+12)}else{var v=d3.scale.linear().domain([0,d3.max(d,function(a){return d3.max(a.data,itemgetter(1))})]).range([s-p,p]);a.selectAll().data(d).enter().append("svg:path").attr("d",function(a){return d3.svg.line().x(compose(t,as_date,itemgetter(0))).y(compose(v,itemgetter(1))).defined(compose(not_null,itemgetter(1)))(a.data)}).style("stroke",function(a){return a.color}).attr("class","plotline");for(var i=0;i<d.length;++i){var j=d[i],z=get_area_mean(j.data);null!=z.mean&&(a.append("svg:text").text(j.label).attr("text-anchor","start").attr("dominant-baseline","central").attr("fill",j.color).attr("x",r-q+10).attr("y",v(z.mean)-12),a.append("svg:text").text("-Mean: "+d3.format(".3s")(z.mean)+b).attr("text-anchor","start").attr("dominant-baseline","central").attr("fill",j.color).attr("x",r-q).attr("y",v(z.mean)),null!=c&&a.append("svg:text").text("Area: "+d3.format(".3s")(z.area)+c).attr("text-anchor","start").attr("dominant-baseline","central").attr("fill",j.color).attr("x",r-q+10).attr("y",v(z.mean)+12))}}a.append("svg:line").attr("x1",q).attr("y1",s-p).attr("x2",r-q).attr("y2",s-p),a.selectAll().data(t.ticks(13)).enter().append("svg:g").attr("transform",function(a){return"translate("+t(a)+","+(s-p/2)+")"}).append("svg:text").attr("transform","rotate(45)").attr("text-anchor","middle").attr("dominant-baseline","central").text(t.tickFormat(13)),a.selectAll().data(t.ticks(13)).enter().append("svg:line").attr("x1",t).attr("y1",s-p).attr("x2",t).attr("y2",s-p+5),a.append("svg:line").attr("x1",q).attr("y1",s-p).attr("x2",q).attr("y2",p),a.selectAll().data(v.ticks(6)).enter().append("svg:line").attr("x1",q-5).attr("y1",v).attr("x2",q).attr("y2",v),a.selectAll().data(v.ticks(6)).enter().append("svg:text").text(compose(function(a){return a+b},d3.format(".2s"))).attr("x",q/2).attr("y",v).attr("dominant-baseline","central").attr("text-anchor","middle")}function plot_later(a,b,c,d,e,f,g){var h=d.length;d.map(function(i){d3.json(i.url,function(j){i.data=j,h--,0==h&&plot(a,b,c,d,e,f,g)})})}function data_to_lines(a,b){for(var c={},d=0;d<a.length;++d)if(null!=a[d][1])for(var e in a[d][1])a[d][1][e]!=a[d][3]&&(c[e]=null);var f=[];for(var e in c)f.push(e);f.sort(),lines=[];for(var d=0;d<f.length;d++)lines.push({data:a.map(function(a){return[a[0],null==a[1]?null:f[d]in a[1]?a[1][f[d]]:a[3],a[2]]}),color:d3.hsl(360*(d/f.length),.5,.5),label:f[d]});if(void 0==b)var b=function(a){return d3.max(a.data,function(a){return a[1]})};return lines.sort(function(a,c){return b(a)-b(c)}),lines}var period="day",trackerAddress=localStorage.vtcTrackerAddress,explorer_prefix="http://cryptexplorer.com/",block_values=[];"undefined"==typeof trackerAddress&&(trackerAddress="Your Address"),$(document).ready(function(){$("[rel=tooltip]").tooltip({placement:"right"})});